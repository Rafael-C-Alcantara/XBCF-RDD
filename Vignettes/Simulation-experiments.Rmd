---
title: "Updates"
author: "Rafael Alcantara"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = TRUE)
```

## Summary
* Things that break T-learner BART:
1. High variability in $\mu(X,W)$ both with respect to $X$ and $W$
2. Small sample sizes
3. Non-separable $\mu$
4. Noise
* However, it seems to work fine for larger sample sizes
* How our prior works:
1. 3 parameters: window size (Owidth), minimum number of treat./control points (Omin), and prop. of points inside the window (Opct)
2. We set Opct < 0.3 because values above that commonly led to many invalid trees being sampled; we have been using Opct = 0.1, as that seemed to work best in most scenarios
3. We have been using Omin = 2 as a default, but values up until 5 seemed to work fine
4. Owidth needs to be changed with the sample size; we set it by determining the smallest window around $X=c$ to contain at least `pts_in_window` points in each side of the window;
5. Owidth also interacts with Opct: the less you "trim" the borders of the window, the tighter your window needs to be
6. Number of trees matters a lot; in particular, in some harder cases we need >150 trees in each forest to avoid over-regularization
* Moving forward: framing of the paper and second draft
1. Dropping S-learner BART
2. Making it more of a general investigation of BART in RDD, showing when naive BART works, when it doesn't, and when our modification can help
3. Basically done with the simulations; we just need to figure out a few set of comparisons (among all of those we already have) that illustrate the points clearly enough; then, we can move on with the re-write
## Some simulated examples
### Easy setup: low prognostic variability, low noise
```{r}
n <- 2000
ate <- 0.5
k1 <- 1 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 1 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 50
x.center <- 0 ## In case we want to center x at a different location
# BARDDT parameters
Omin <- 1
Opct <- 0.1
ntrees_con <- 150
ntrees_mod <- 150
source("simulation_function_definitions.R")
```

```{r}
n <- 4000
ate <- 0.5
k1 <- 1 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 1 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 100
x.center <- 0 ## In case we want to center x at a different location
source("simulation_function_definitions.R")
```
### Large prognostic variability in X
```{r}
n <- 2000
ate <- 0.5
k1 <- 10 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 1 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 50
x.center <- 0 ## In case we want to center x at a different location
# BARDDT parameters
Omin <- 1
Opct <- 0.1
ntrees_con <- 150
ntrees_mod <- 150
source("simulation_function_definitions.R")
```

```{r}
n <- 4000
ate <- 0.5
k1 <- 10 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 1 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 100
x.center <- 0 ## In case we want to center x at a different location
source("simulation_function_definitions.R")
```
### Large prognostic variability in W
```{r}
n <- 2000
ate <- 0.5
k1 <- 1 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 10 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 50
x.center <- 0 ## In case we want to center x at a different location
source("simulation_function_definitions.R")
```

```{r}
n <- 4000
ate <- 0.5
k1 <- 1 ## variability in mu0.x
k2 <- 1 ## amplitude of tau0.w relative to ATE (set from 0 to 1)
k3 <- 10 ## sd of mu0.w relative to sd of tau
sig_error <- 0.2 ## relative to sd of tau
p <- 2 # Dim of w
rho <- 0
c <- 0
s <- 2 ## Sim reps
pts_in_window <- 100
x.center <- 0 ## In case we want to center x at a different location
source("simulation_function_definitions.R")
```

