direction = "wide")
head(shares)
shocks <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shocks.dta")
shares <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shares.dta")
gc()
reshape(shares[1:10,],
idvar=c("year","nit","sic2","pais"),
timevar = "pais_import",
direction = "wide")
reshape(shares[1:100,],
idvar=c("year","nit","sic2","pais"),
timevar = "pais_import",
direction = "wide")
table(shares$pais_import)
length(table(shares$pais_import))
max(table(shares$pais_import))
shocks <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shocks.dta")
shares <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shares.dta")
summary(shares)
library(dplyr)
library(readstata13)
imports <- read.dta13("C:/Users/rafae/Downloads/ssiv/import_res(2).dta",
select.cols = c("ano","sic2","nit", "fob_dol_import","pais_import"))
imports <- imports[complete.cases(imports),]
exports <- read.dta13("C:/Users/rafae/Downloads/Editor/ResumoExportacoes.dta")
exports <- exports[complete.cases(exports),]
exports <- exports %>%
group_by(ano,nit,pais,sic2) %>%
summarise(fob_dol=sum(fob_dol)) %>%
ungroup()
er      <- read.dta13("C:/Users/rafae/Downloads/Editor/er.dta")
er <- er[complete.cases(er),]
imp <- exports[exports$nit %in% imports$nit == T,]
imp <- imp %>%
group_by(nit,sic2) %>%
summarise(count=n()) %>%
ungroup() %>%
select(-count)
imports <- imports %>%
group_by(nit,pais_import) %>%
filter(ano==min(ano)) %>%
summarise(fob_dol_import=sum(fob_dol_import)) %>%
ungroup()
gc()
View(imports)
View(imp)
merge(imp,importers)
merge(imp,imports)
imp <- merge(imp,imports)
View(imp)
imp <- imp %>%
group_by(sic2,pais_import) %>%
summarise(fob_dol_import=sum(fob_dol_import,na.rm=T)) %>%
ungroup()
View(imp)
View(imp)
imp <- imp %>% filter(fob_dol_import>0)
View(imp)
gc()
imports <- merge(imports,er)
share.imp <- imports %>%
group_by(nit,year) %>%
mutate(shares = fob_dol_import/sum(fob_dol_import)) %>%
select(-fob_dol_import) %>%
ungroup()
gc()
share.nimp <- merge(imp,er)
View(share.nimp)
View(share.nimp)
share.nimp <- share.nimp %>%
group_by(sic2,year) %>%
mutate(shares=fob_dol_import/sum(fob_dol_import)) %>%
select(-fob_dol_import) %>%
ungroup()
View(share.nimp)
View(share.imp)
rm(imp)
gc()
index.imp <- share.imp %>%
group_by(nit,year) %>%
mutate(index = shares*indice_cambio_real) %>%
summarise(index=sum(index)) %>%
ungroup()
gc()
index.nimp <- share.nimp %>%
group_by(sic2,year) %>%
mutate(index = shares*indice_cambio_real) %>%
summarise(index=sum(index)) %>%
ungroup()
gc()
rm(er,exports,imports)
share.imp  <- share.imp[,names(share.imp)!="indice_cambio_real"]
share.nimp <- share.nimp[,names(share.nimp)!="indice_cambio_real"]
gc()
View(share.imp)
View(share.nimp)
shocks <- read.dta13("C:/Users/rafae/Downloads/Editor/cje_regs.dta")
index.imp <- merge(index.imp,shocks[shocks$nit %in% index.imp$nit,])
gc()
index.nimp <- merge(index.nimp,shocks[shocks$nit %in% index.imp$nit == F,])
gc()
index <- rbind(index.imp,index.nimp)
rm(index.imp,index.nimp)
gc()
foreign::write.dta(index, "C:/Users/rafae/Downloads/Editor/shocks.dta")
rm(index)
gc()
share.imp <- merge(share.imp,shocks[shocks$nit %in% share.imp$nit,c("nit","pais","sic2","year")])
gc()
share.nimp <- merge(share.nimp,shocks[shocks$nit %in% share.imp$nit == F,c("nit","pais","sic2","year")])
gc()
shares <- rbind(share.imp,share.nimp)
rm(share.imp,share.nimp)
shares <- shares[complete.cases(shares),]
gc()
foreign::write.dta(shares, "C:/Users/rafae/Downloads/Editor/shares.dta")
rm(shares,shocks)
gc()
library(dplyr)
library(readstata13)
imports <- read.dta13("C:/Users/rafae/Downloads/ssiv/import_res(2).dta",
select.cols = c("ano","sic2","nit", "fob_dol_import","pais_import"))
imports <- imports[complete.cases(imports),]
exports <- read.dta13("C:/Users/rafae/Downloads/Editor/ResumoExportacoes.dta")
exports <- exports[complete.cases(exports),]
exports <- exports %>%
group_by(ano,nit,pais,sic2) %>%
summarise(fob_dol=sum(fob_dol)) %>%
ungroup()
er      <- read.dta13("C:/Users/rafae/Downloads/Editor/er.dta")
er <- er[complete.cases(er),]
imp <- exports[exports$nit %in% imports$nit == T,]
imp <- imp %>%
group_by(nit,sic2) %>%
summarise(count=n()) %>%
ungroup() %>%
select(-count)
imports <- imports %>%
group_by(nit,pais_import) %>%
filter(ano==min(ano)) %>%
summarise(fob_dol_import=sum(fob_dol_import)) %>%
ungroup()
gc()
imports <- merge(imports,er)
share.imp <- imports %>%
group_by(nit,year) %>%
mutate(shares = fob_dol_import/sum(fob_dol_import)) %>%
select(-fob_dol_import) %>%
ungroup()
gc()
share.imp <- share.imp[complete.cases(share.imp),]
summary(aggregate(shares~nit+year,share.imp,sum))
gc()
index.imp <- share.imp %>%
group_by(nit,year) %>%
mutate(index = shares*indice_cambio_real) %>%
summarise(index=sum(index)) %>%
ungroup()
gc()
rm(er,exports,imports)
share.imp  <- share.imp[,names(share.imp)!="indice_cambio_real"]
gc()
shocks <- read.dta13("C:/Users/rafae/Downloads/Editor/cje_regs.dta")
index.imp <- merge(index.imp,shocks[shocks$nit %in% index.imp$nit,])
gc()
share.imp <- merge(share.imp,shocks[shocks$nit %in% share.imp$nit,c("nit","pais","sic2","year")])
gc()
foreign::write.dta(index.imp, "C:/Users/rafae/Downloads/Editor/shocks.dta")
foreign::write.dta(share.imp, "C:/Users/rafae/Downloads/Editor/shares.dta")
gc()
library(dplyr)
library(readstata13)
imports <- read.dta13("C:/Users/rafae/Downloads/ssiv/import_res(2).dta",
select.cols = c("ano","sic2","nit", "fob_dol_import","pais_import"))
imports <- imports[complete.cases(imports),]
exports <- read.dta13("C:/Users/rafae/Downloads/Editor/ResumoExportacoes.dta")
exports <- exports[complete.cases(exports),]
exports <- exports %>%
group_by(ano,nit,pais,sic2) %>%
summarise(fob_dol=sum(fob_dol)) %>%
ungroup()
er      <- read.dta13("C:/Users/rafae/Downloads/Editor/er.dta")
er <- er[complete.cases(er),]
imp <- exports[exports$nit %in% imports$nit == T,]
imp <- imp %>%
group_by(nit,sic2) %>%
summarise(count=n()) %>%
ungroup() %>%
select(-count)
imports <- imports %>%
group_by(nit,pais_import) %>%
filter(ano==min(ano)) %>%
summarise(fob_dol_import=sum(fob_dol_import)) %>%
ungroup()
foreign::read.dta("C:/Users/rafae/Downloads/Editor/shares.dta")
shares <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shares.dta")
head(shares)
summary(aggregate(shares~nit+pais+sic2+year,data=shares,sum))
shares <- foreign::read.dta("C:/Users/rafae/Downloads/Editor/shares.dta")
summary(aggregate(shares~nit+pais+sic2+year,data=shares,sum))
install.packages(devtools)
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
library(devtools)
library(devtools)
library(ddevtools)
library(devtools)
install.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("cli")
library(devtools)
set.seed(000)
dgp <- function(n,p,cutoff,covs,lBound,uBound,p1=NA) {
w <- matrix(rnorm(n*p),nrow=n,ncol=p)
if (covs=="all") {
x   <- rnorm(n,rowMeans(w)-cutoff,10)
z   <- x>=0
mu0 <- function(x,w,p) lBound + x + w%*%1:p/10
mu1 <- function(x,w,p) uBound + 2*x + w%*%3:(p+2)/10
y0  <- rnorm(n,mu0(x,w,p),1)
y1  <- rnorm(n,mu1(x,w,p),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x,w,p),mu1=mu1(x,w,p),x=x,z=z,w=w))
}
if (covs=="partial") {
w1 <-  matrix(rnorm(n*p1),nrow=n,ncol=p1)
x  <- rnorm(n,rowMeans(w)+rowMeans(w1)-cutoff,10)
z  <- x>=0
mu0 <- function(x,w,p) lBound + x + w%*%1:p/10
mu1 <- function(x,w,p) uBound + 2*x + w%*%3:(p+2)/10
y0  <- rnorm(n,mu0(x,w,p),1)
y1  <- rnorm(n,mu1(x,w,p),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x,w,p),mu1=mu1(x,w,p),x=x,z=z,w=w))
}
}
n <- 200
p <- 5
c <- 2
l <- 5
u <- 10
p1 <- 5
data1 <- dgp(n,p,c,"all",5,10)
data2 <- dgp(n,p,c,"partial",5,10,p1)
plot(data1$x,data1$y)
matlines(data1$x[order(data1$x)],cbind(data1$mu0,data1$mu1)[order(data1$x),])
matlines(data1$x[order(data1$x)],cbind(data1$mu0,data1$mu1)[order(data1$x),],lty=1,col="black")
plot(data1$x,data1$y)
matlines(data1$x[order(data1$x)],cbind(data1$mu0,data1$mu1)[order(data1$x),],lty=1,col="black")
dgp <- function(n,p,cutoff,covs,lBound,uBound,p1=NA) {
w <- matrix(rnorm(n*p),nrow=n,ncol=p)
if (covs=="all") {
x   <- rnorm(n,rowMeans(w)-cutoff,10)
z   <- x>=0
mu0 <- function(x) lBound + x
mu1 <- function(x) uBound + 2*x
y0  <- rnorm(n,mu0(x),1)
y1  <- rnorm(n,mu1(x),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x),mu1=mu1(x),x=x,z=z,w=w))
}
if (covs=="partial") {
w1 <-  matrix(rnorm(n*p1),nrow=n,ncol=p1)
x  <- rnorm(n,rowMeans(w)+rowMeans(w1)-cutoff,10)
z  <- x>=0
mu0 <- function(x,w,p) lBound + x
mu1 <- function(x,w,p) uBound + 2*x
y0  <- rnorm(n,mu0(x),1)
y1  <- rnorm(n,mu1(x),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x),mu1=mu1(x),x=x,z=z,w=w))
}
}
n <- 200
p <- 5
c <- 2
l <- 5
u <- 10
p1 <- 5
data1 <- dgp(n,p,c,"all",5,10)
data2 <- dgp(n,p,c,"partial",5,10,p1)
plot(data1$x,data1$y)
plot(data1$w[,1],data1$y)
plot(data1$w[,2],data1$y)
plot(data1$w[,3],data1$y)
plot(data1$w[,4],data1$y)
dgp <- function(n,p,cutoff,covs,lBound,uBound,p1=NA) {
w <- matrix(rnorm(n*p,0,10),nrow=n,ncol=p)
if (covs=="all") {
x   <- rnorm(n,rowMeans(w)-cutoff,10)
z   <- x>=0
mu0 <- function(x) lBound + x
mu1 <- function(x) uBound + 2*x
y0  <- rnorm(n,mu0(x),1)
y1  <- rnorm(n,mu1(x),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x),mu1=mu1(x),x=x,z=z,w=w))
}
if (covs=="partial") {
w1 <-  matrix(rnorm(n*p1,0,10),nrow=n,ncol=p1)
x  <- rnorm(n,rowMeans(w)+rowMeans(w1)-cutoff,10)
z  <- x>=0
mu0 <- function(x,w,p) lBound + x
mu1 <- function(x,w,p) uBound + 2*x
y0  <- rnorm(n,mu0(x),1)
y1  <- rnorm(n,mu1(x),1)
y   <- y1*z + y0*(!z)
return(list(y=y,mu0=mu0(x),mu1=mu1(x),x=x,z=z,w=w))
}
}
data1 <- dgp(n,p,c,"all",5,10)
data2 <- dgp(n,p,c,"partial",5,10,p1)
plot(data1$w[,1],data1$y)
plot(data1$w[,2],data1$y)
hist(rnorm(100)+rnorm(100,10,1))
hist(rnorm(100)+rnorm(100,2,1))
hist(rnorm(100)+rnorm(100,3,1))
hist(rnorm(100,0,1)+rnorm(100,3,1))
hist(rnorm(100,-1,1)+rnorm(100,3,1))
hist(rnorm(100,-10,1)+rnorm(100,3,1))
hist(rnorm(100,-10,1)+rnorm(100,30,1))
hist(rnorm(100,-10,1)+rnorm(100,10,1))
hist(.7*rnorm(100,-10,1)+.3*rnorm(100,10,1))
hist(.7*rnorm(1000,-10,1)+.3*rnorm(1000,10,1))
hist(.5*rnorm(1000,-10,1)+.5*rnorm(1000,10,1))
hist(.5*rnorm(1000,-1,1)+.5*rnorm(1000,1,1))
hist(runif(1000)<.5)*rnorm(1000,-1,1)+(runif(1000)>.5)*rnorm(1000,1,1))
hist((runif(1000)<.5)*rnorm(1000,-1,1)+(runif(1000)>.5)*rnorm(1000,1,1))
p <- runif(n)
hist((p<.5)*rnorm(n,-1,1)+(p>.5)*rnorm(n,1,1))
hist((p<.5)*rnorm(n,-1,.25)+(p>.5)*rnorm(n,1,.25))
hist((p<.5)*rnorm(n,-10,1)+(p>.5)*rnorm(n,10,1))
hist((p<.5)*rnorm(n,-10,10)+(p>.5)*rnorm(n,10,10))
hist((p<.5)*rnorm(n,-10,100)+(p>.5)*rnorm(n,10,100))
library(devtools)
library(usethis)
library(devtools)
usethis::edit_r_makevars()
install_github("JingyuHe/XBART@XBCF-RDD")
usethis::edit_r_makevars()
install_github("JingyuHe/XBART@XBCF-RDD")
usethis::edit_r_makevars()
install_github("JingyuHe/XBART@XBCF-RDD")
usethis::edit_r_makevars()
usethis::edit_r_makevars()
rm(list=ls())
n <- 500
p <- 10
c <- 0
s <- 1000 # samples
setwd("~/Git/XBCF-RDD/")
set.seed(0)
source("R/simulations_setup.R")
burn <- 100
nsamples <- 100
time <- rep(0,4*s)
P = c(.70,.30);
mz = c(3, 3);
mztau = c(3, 2);
lamstmean0_ = rep(1,12);
lamstsd0_ = 5*rep(1,12);
s2mean0_ = .3;
s2sd0_ = 1;
nudgp = 3;
nuval = 3;
results.fh <- matrix(0,s,4)
for (i in 1:s)
{
print(paste0("Simulation ",i," for FH data"))
dgp(n,p,"fh")
t0 <- Sys.time()
ate.cgs <- bayesrddest(y = y,
z = x,
W = w,
mw = rep(5,10), ## as per help file
tau = c,
p = P,
mz = mz,
mztau = mztau,
beta0_ = matrix(0,nrow=24),
lamstmean0_ = lamstmean0_,
lamstsd0_ = lamstsd0_,
d = rep(1,length(lamstsd0_)),
s2mean0_ = s2mean0_,
s2sd0_ = s2sd0_,
distribution = "gaussian",
nuval = nuval,
hetero = FALSE,
n0=burn,
m=nsamples)
ate.cgs <- c(mean(ate.cgs$atem),quantile(ate.cgs$atem,c(.025,.975)))
results.fh[i,1:3] <- ate.cgs
results.fh[i,4] <- ate
t1 <- Sys.time()
time[3*s+i] <- t1-t0
}
mean((results.fh[,1]-results.fh[,4])^2)
results <- readRDS("Results/results_cgs.rds")
results <- list(CGS0=results$CGS0,CGS=results$CGS,FH=results.fh,KR=results$KR)
lapply(results,function(x) mean((x[,1]-x[,4])^2))
saveRDS(results,"Results/results_cgs.rds")
dgp(n,p,"cgs")
y
x
w
z
Owidth<-findOwidth(0.01)
Owidth
pred.gp <- predict.XBCFrdgp(fit.XBCFrd,NULL,x,NULL,rep(0,n))
q("no")
Owidth
pred.gp <- predict.XBCFrdgp(fit.XBCFrd,NULL,x,NULL,rep(0,n))
q("no")
Owidth
pred.gp <- predict.XBCFrdgp(fit.XBCFrd,NULL,x,NULL,rep(0,n))
Owidth
pred.gp <- predict.XBCFrdgp(fit.XBCFrd,w,x,w,rep(0,n))
Owidth
Owidth <- findOwidth(0.01)
Owidth
pred.ate.xbcf0()
Omin <- 5
Owidth <- findOwidth(0.01)
Owidth
pred.ate.xbcf0()
Omin <- 10
Owidth <- findOwidth(0.01)
Owidth
pred.ate.xbcf0()
Omin
0.6*var(y)/10
var(y)/10
Owidth
pred.ate.xbcf0()
pred.ate.xbcf0
pred.ate.xbcf0()
s <- 50
results.cgs0
mean((results.cgs0[,1]-results.cgs0[,4])^2)
mean(results.cgs0[,4] >= results.cgs0[,2] & results.cgs0[,4] <= results.cgs0[,3])
s <- 1000
q("no")
dgp(n,p,"cgs")
findOwidth(0.01)
q("no")
